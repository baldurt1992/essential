import{_ as V,u as C,r as t,c as b,o as L,a as S,b as n,d as k,e as a,t as E,f as T,w as R,g as x,R as I,h as z,i as _,j as H,k as N,l as D,m as l}from"./app-hX1QvZtv.js";/* empty css            */const j={class:"purchase-confirmation"},G={key:0,class:"purchase-confirmation__loading"},U={key:1,class:"purchase-confirmation__error"},A={class:"purchase-confirmation__message"},F={class:"purchase-confirmation__actions"},J={key:2,class:"purchase-confirmation__success"},K=["innerHTML"],O={key:0,class:"purchase-confirmation__resend"},Q={key:0},W={key:1},X={key:0,class:"purchase-confirmation__countdown"},Y={class:"purchase-confirmation__actions"},Z={__name:"PurchaseConfirmationPage",setup(ee){const P=H();D();const q=C(),g=t(!0),c=t(!1),v=t(""),s=t(null),p=t(null),m=t(!1),d=t(!1),f=t(null),u=t(60),i=t(null),h=b(()=>s.value&&!s.value.user_id),$=b(()=>v.value||"No pudimos verificar tu compra. Si realizaste el pago, revisa tu correo electrónico."),B=b(()=>{if(!s.value)return"";const o=s.value.template?.title||"la plantilla";if(h.value){let e=`Hemos enviado el enlace de descarga de <strong>${o}</strong> a <strong>${s.value.guest_email}</strong>. Revisa tu correo electrónico para descargar la plantilla.`;return p.value&&(e+=`<br><br>Si no recibiste el correo, no dudes en escribirnos a <a href="mailto:${p.value}" style="color: #dd3333; text-decoration: underline;">${p.value}</a>`),e}return`Tu compra de <strong>${o}</strong> ha sido procesada correctamente. Revisa tu correo electrónico para obtener el código de compra.`}),y=async(o=0)=>{const e=P.query.session_id;if(!e){c.value=!0,v.value="No se proporcionó un ID de sesión válido.",g.value=!1;return}try{const r=await N.get(`/api/purchases/verify/${e}`);if(r.data.purchase)s.value=r.data.purchase,p.value=r.data.contact_email||null,w();else{if(o<5){setTimeout(()=>{y(o+1)},2e3);return}c.value=!0,v.value=r.data.message||"No se pudo verificar la compra. Si realizaste el pago, revisa tu correo electrónico."}}catch(r){if(r.response?.status===404&&o<5){setTimeout(()=>{y(o+1)},2e3);return}c.value=!0,v.value=r.response?.data?.message||"Error al verificar la compra. Si realizaste el pago, revisa tu correo electrónico."}finally{(s.value||c.value)&&(g.value=!1)}},M=async()=>{if(!(!s.value||!h.value)){m.value=!0;try{await N.post(`/api/purchases/${s.value.uuid}/resend-link`,{email:s.value.guest_email}),q.add({severity:"success",summary:"Enlace reenviado",detail:"El enlace de descarga ha sido enviado nuevamente a tu correo electrónico.",life:5e3}),d.value=!1,w()}catch(o){const e=o.response?.data?.message||"Error al reenviar el enlace.";q.add({severity:"error",summary:"Error",detail:e,life:5e3})}finally{m.value=!1}}},w=()=>{i.value&&clearInterval(i.value),f.value&&clearTimeout(f.value),u.value=60,d.value=!1,i.value=setInterval(()=>{u.value--,u.value<=0&&(clearInterval(i.value),i.value=null,d.value=!0)},1e3)};return L(()=>{y()}),S(()=>{i.value&&clearInterval(i.value),f.value&&clearTimeout(f.value)}),(o,e)=>{const r=z("Button");return l(),n("div",j,[g.value?(l(),n("div",G,[...e[0]||(e[0]=[a("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2rem",color:"var(--qode-heading-color)"}},null,-1),a("p",{class:"purchase-confirmation__loading-message"},"Verificando tu compra...",-1)])])):c.value?(l(),n("div",U,[e[2]||(e[2]=a("div",{class:"purchase-confirmation__icon"},[a("i",{class:"pi pi-times-circle"})],-1)),e[3]||(e[3]=a("h1",{class:"purchase-confirmation__title"},"Pago no completado",-1)),a("p",A,E($.value),1),a("div",F,[T(x(I),{to:{name:"templates"},class:"qodef-button qodef-button--ghost"},{default:R(()=>[...e[1]||(e[1]=[_(" Volver a plantillas ",-1)])]),_:1})])])):s.value?(l(),n("div",J,[e[8]||(e[8]=a("div",{class:"purchase-confirmation__icon"},[a("i",{class:"pi pi-check-circle"})],-1)),e[9]||(e[9]=a("h1",{class:"purchase-confirmation__title"},"¡Compra completada!",-1)),a("p",{class:"purchase-confirmation__message",innerHTML:B.value},null,8,K),h.value?(l(),n("div",O,[e[6]||(e[6]=a("p",{class:"purchase-confirmation__resend-message"}," ¿No recibiste el correo? Espera un minuto y luego puedes reenviarlo. ",-1)),T(r,{onClick:M,class:"qodef-button qodef-button--primary",disabled:m.value||!d.value},{default:R(()=>[e[4]||(e[4]=a("i",{class:"pi pi-envelope"},null,-1)),m.value?(l(),n("span",W,"Enviando...")):(l(),n("span",Q,"Reenviar enlace de descarga"))]),_:1},8,["disabled"]),!d.value&&u.value>0?(l(),n("p",X,[e[5]||(e[5]=_(" Podrás reenviar en ",-1)),a("strong",null,E(u.value),1),_(" segundo"+E(u.value!==1?"s":""),1)])):k("",!0)])):k("",!0),a("div",Y,[T(x(I),{to:{name:"templates"},class:"qodef-button qodef-button--ghost"},{default:R(()=>[...e[7]||(e[7]=[_(" Explorar más plantillas ",-1)])]),_:1})])])):k("",!0)])}}},oe=V(Z,[["__scopeId","data-v-97209558"]]);export{oe as default};
